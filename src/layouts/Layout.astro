---
import "../styles/global.css";
import { ui, defaultLang } from '../i18n/ui';

const { title = "Digital Garden / Archivo Personal", fullWidth = false, hideHeader = false } = Astro.props;

const lang = Astro.currentLocale || defaultLang;

function t(key) {
  return ui[lang][key] || ui[defaultLang][key];
}

const baseUrl = import.meta.env.BASE_URL.replace(/\/$/, '');

function getPath(path) {
    const langPath = lang === 'en' ? '/en' : '';
    return `${baseUrl}${langPath}${path}`;
}

function getLangSwitchPath(targetLang) {
    const langPrefix = targetLang === 'en' ? '/en' : '';
    if (baseUrl === '' && targetLang === 'es') return '/';
    return `${baseUrl}${langPrefix}` || '/'; 
}
---

<html lang={lang}>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/svg+xml" href={`${baseUrl}/favicon.svg`} />
    <title>{title}</title>
    
    <style>
      :root {
        /* Mantenemos tus colores originales de los 90s */
        --color-bg: #111111;
        --color-text-light: #dddddd;
        --color-text-accent: #666666;
        --color-highlight: #23909e; /* Un toque ámbar para resaltar */
        --font-mono: 'Courier New', Courier, monospace;
      }
      
      body {
        background-color: var(--color-bg);
        color: var(--color-text-light);
        font-family: var(--font-mono);
  
        
        width: 100%;             /* Ocupa todo el ancho posible */
        max-width: 1400px;       /* Tope máximo para pantallas gigantes */
        margin: 0 auto;          /* Centra el contenido */
        padding: 1rem;           /* Margen interno pequeño para celulares */
        box-sizing: border-box;  /* Asegura que el padding no rompa el ancho */
        line-height: 1.6;
      }

      /* === AJUSTE PARA PANTALLAS GRANDES (Laptop/Desktop) === */
      @media (min-width: 768px) {
        body {
          padding: 3rem; /* Más aire en pantallas grandes */
        }
      }

      /* Cuando es FullWidth, el body pierde sus márgenes para el 3D */
      body.fullWidth {
        max-width: none;
        margin: 0;
        padding: 0;
      }

      header { 
        margin-bottom: 3rem; 
        border-bottom: 1px dashed var(--color-text-accent); /* Línea punteada más retro */
        padding-bottom: 1.5rem;
      }
      
      /* --- NEW: Constraint class for the Header in FullWidth mode --- */
      /* This restores the "Container" look just for the header */
      .header-constrained {
        max-width: 1400px;
        margin-left: auto;
        margin-right: auto;
        
        /* Restoring the padding that BODY usually provides */
        padding-top: 1rem;
        padding-left: 1rem;
        padding-right: 1rem;
      }

      @media (min-width: 768px) {
        .header-constrained {
          padding-top: 3rem;
          padding-left: 3rem;
          padding-right: 3rem;
        }
      }

      h1 { 
        font-weight: normal; 
        font-size: 1.5rem;
        margin-bottom: 0.5rem;
        letter-spacing: -1px;
      }
      
      nav { margin-top: 1rem; }

      a { 
        color: var(--color-text-accent); 
        text-decoration: none; 
        margin-right: 15px; 
        text-transform: uppercase; /* Forzamos mayúsculas para estilo terminal */
        font-size: 0.9rem;
      }
      a:hover { 
        color: var(--color-highlight); 
        text-decoration: underline;
      }
      a.active {
        color: var(--color-text-light);
        font-weight: bold;
      }
      
      .lang-switch { 
        float: right; 
        font-size: 0.8em; 
      }
    </style>
  </head>
  
  <body class={fullWidth ? "fullWidth" : ""}>
    {!hideHeader && (
    <header class={fullWidth ? "header-constrained" : ""}>
      <div class="lang-switch">
        <a href={getLangSwitchPath('es')}>[ES]</a> <a href={getLangSwitchPath('en')}>[EN]</a>
      </div>

      <h1>{title}</h1>
      
      <nav>
        <a href={getPath('/')}>[LOBBY]</a>
        <a href={getPath('/musica')}>[CURADURÍA]</a>
        <a href={getPath('/videos')}>[VIDEOS]</a>
        <a href={getPath('/cv')}>[CV]</a>
      </nav>
    </header>
    )}

    <main>
        <slot />
    </main>

  </body>
</html>