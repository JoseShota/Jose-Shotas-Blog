---
import "../styles/global.css";
import { ui, defaultLang } from '../i18n/ui';

const { title = "Digital Garden / Archivo Personal", fullWidth = false, hideHeader = false } = Astro.props;

// Detectar el idioma actual basado en la URL
const lang = Astro.currentLocale || defaultLang;

// Función para obtener las traducciones
function t(key) {
  return ui[lang][key] || ui[defaultLang][key];
}

// === LÓGICA DE RUTAS (CORREGIDA) ===
// Obtenemos la ruta base (ej: "/Jose-Shotas-Blog") y quitamos la barra final si la tiene
const baseUrl = import.meta.env.BASE_URL.replace(/\/$/, '');

function getPath(path) {
    // Si es inglés, agregamos /en
    const langPath = lang === 'en' ? '/en' : '';
    // Construimos: /Nombre-Repo + /en (opcional) + /musica
    return `${baseUrl}${langPath}${path}`;
}

// Función especial para el switch de idiomas (Header)
function getLangSwitchPath(targetLang) {
    const langPrefix = targetLang === 'en' ? '/en' : '';
    // Si la base es vacía (desarrollo local) y queremos ir al home español, devolvemos "/"
    if (baseUrl === '' && targetLang === 'es') return '/';
    
    // Retorna "/Jose-Shotas-Blog" (para ES) o "/Jose-Shotas-Blog/en" (para EN)
    return `${baseUrl}${langPrefix}` || '/'; 
}
---

<html lang={lang}>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    
    <link rel="icon" type="image/svg+xml" href={`${baseUrl}/favicon.svg`} />
    
    <title>{title}</title>
    
    <style>
      :root {
        --color-bg: #111111;
        --color-text-light: #dddddd;
        --color-text-accent: #666666;
        --font-mono: 'Courier New', Courier, monospace;
      }
      body {
        background-color: var(--color-bg);
        color: var(--color-text-light);
        font-family: var(--font-mono);
        max-width: 800px;
        margin: 0 auto;
        padding: 2rem;
        line-height: 1.6;
      }
      body.fullWidth {
        max-width: none;
        margin: 0;
        padding: 0;
      }
      header { margin-bottom: 3rem; }
      
      h1 { 
        font-weight: normal; 
        border-bottom: 1px solid var(--color-text-accent); 
        padding-bottom: 1rem; 
      }
      a { 
        color: var(--color-text-accent); 
        text-decoration: none; 
        margin-right: 15px; 
      }
      a:hover { color: var(--color-text-light); }
      
      /* Estilo del selector de idioma */
      .lang-switch { 
        float: right; 
        font-size: 0.8em; 
      }
    </style>
  </head>
  
  <body class={fullWidth ? "fullWidth" : ""}>
    {!hideHeader && (
    <header>
      <div class="lang-switch">
        <a href={getLangSwitchPath('es')}>ES</a> / <a href={getLangSwitchPath('en')}>EN</a>
      </div>

      <h1>{title}</h1>
      
      <nav>
        <a href={getPath('/')}>{t('nav.home')}</a>
        <a href={getPath('/musica')}>{t('nav.music')}</a>
        <a href={getPath('/videos')}>{t('nav.videos')}</a>
        <a href={getPath('/cv')}>{t('nav.cv')}</a>
      </nav>
    </header>
    )}

    <main>
        <slot />
    </main>

  </body>
</html>