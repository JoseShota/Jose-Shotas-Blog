---
import BaseLayout from '../layouts/Layout.astro';
import VideoHall from '../components/VideoHall.astro';
import VideoDeck from '../components/VideoDeck.jsx'; // Import the new component
import videos from '../data/videos.json';

const pageTitle = "Nuestra Cueva Virtual/ El museo audiovisual de Jose Shota";

// We keep your height calculation for desktop, 
// but for mobile we don't need scroll height because the deck is fixed position.
const totalHeight = Math.max(2000, videos.length * 900) + "px";
---

<BaseLayout title={pageTitle} fullWidth={true}>
    
    <div class="desktop-view">
        <div class="intro-overlay">
            <h2>>> ACCESSING ARCHIVE...</h2>
            <p>Scroll down to enter the Virtual Hall.</p>
            <div class="arrow">â†“</div>
        </div>

        <VideoHall />

        <div style={`height: ${totalHeight};`}></div>
    </div>

    <div class="mobile-view">
        <div class="mobile-header">
            <h2>>> VIRTUAL DECK</h2>
            <p>Swipe cards to browse archive.</p>
        </div>
        
        <VideoDeck client:load />
    </div>

</BaseLayout>

<style>
    /* --- MEDIA QUERIES FOR SWITCHING --- */
    
    /* DEFAULT: Desktop/Mouse device (The Hall) */
    .desktop-view {
        display: block;
    }
    /* RULE 1 & 2 combined logic for .mobile-view */
    /* We make the container a flex column so items sit naturally */
    .mobile-view {
        display: block; /* Triggered by media queries */
        height: 100vh;
        width: 100%;
        overflow: hidden;
        display: flex;            /* <--- CHANGE: Flexbox */
        flex-direction: column;   /* <--- CHANGE: Vertical Stack */
        justify-content: center;  /* <--- CHANGE: Center content vertically */
        align-items: center;      /* <--- CHANGE: Center content horizontally */
        padding-bottom: 2rem;     /* Add some bottom breathing room */
    }

    /* RULE 1: STRICTLY TOUCH DEVICES 
       We removed the width constraint here. 
       If the user is using a finger (coarse pointer), they get the Deck.
       This catches iPad Pro in Landscape (which is wide) without hurting Laptops (which use mouse).
    */
    @media (pointer: coarse) {
        .desktop-view { display: none; }
        .mobile-view  { 
            display: block; 
            height: 100vh;
            overflow: hidden;
            padding-top: 40px;
        }
    }

    /* RULE 2: TINY SCREENS (Phones/Small Windows)
       We keep this at 768px. 
       Most laptops are at least 1024px or 1280px wide. 
       This ensures that if a computer user resizes their window somewhat small, 
       they generally keep the 3D Hall until it becomes absurdly narrow.
    */
    @media (max-width: 768px) {
        .desktop-view { display: none; }
        .mobile-view  { 
            display: block; 
            height: 100vh;
            overflow: hidden;
            padding-top: 40px;
        }
    }

    /* --- YOUR EXISTING STYLES --- */
    .intro-overlay {
        position: relative;
        z-index: 10;
        text-align: center;
        margin-top: 10vh;
        margin-bottom: 20vh;
        pointer-events: none;
    }
    
    .intro-overlay h2 {
        background: var(--color-bg);
        display: inline-block;
        padding: 0.5rem;
        border: 1px solid var(--color-highlight);
        color: var(--color-highlight);
    }

    .arrow {
        font-size: 2rem;
        animation: bounce 2s infinite;
        margin-top: 1rem;
    }

    /* Mobile Header Styling */
    /* Adjust header to not have huge margins, let Flexbox handle the gap */
    .mobile-header {
        text-align: center;
        margin-top: 2rem;        /* Small top margin */
        margin-bottom: 1rem;     /* Small bottom gap before deck */
        flex-shrink: 0;          /* Prevent header from squishing */
        z-index: 20;
    }
    .mobile-header h2 {
        color: var(--color-highlight);
        font-size: 1.2rem;
        border: 1px dashed var(--color-highlight);
        display: inline-block;
        padding: 5px 10px;
        margin-bottom: 5px;
    }
    .mobile-header p {
        font-family: var(--font-mono);
        font-size: 0.8rem;
        color: var(--color-text-accent);
    }

    @keyframes bounce {
        0%, 20%, 50%, 80%, 100% {transform: translateY(0);}
        40% {transform: translateY(-10px);}
        60% {transform: translateY(-5px);}
    }
</style>